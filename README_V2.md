# SSH Gate v2 - Comprehensive Documentation Index

## üöÄ Quick Start

**–•–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å?**

```bash
sudo bash install_ssh_gate_v2.sh
```

–ó–∞—Ç–µ–º —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–¥—Å–∫–∞–∑–∫–∞–º. ~10-15 –º–∏–Ω—É—Ç –∏ —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞!

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤

1. **[QUICK_START_V2.sh](QUICK_START_V2.sh)** ‚Üê **–ù–ê–ß–ù–ò–¢–ï –û–¢–°–Æ–î–ê**
   - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
   - –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
   - –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

   ```bash
   bash QUICK_START_V2.sh
   ```

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

2. **[V2_ENHANCEMENTS.md](V2_ENHANCEMENTS.md)** - –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ v2
   - Per-user SSH snippets
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ deleted users
   - Protocol-based firewall selection
   - Deduped IPTables rules
   - Deployment archive
   - Final summary report

3. **[ADMIN_GUIDE_V2.md](ADMIN_GUIDE_V2.md)** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, —Ä–æ—Ç–∞—Ü–∏—è)
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSH snippets
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ firewall
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - Troubleshooting

4. **[EXAMPLES_V2.md](EXAMPLES_V2.md)** - –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã
   - Web Server
   - Mail Server
   - Multi-purpose Server
   - Managed Hosting
   - FAQ

### –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å v1

5. **[V1_VS_V2.md](V1_VS_V2.md)** - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
   - –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
   - –ß–µ–≥–æ –Ω–µ—Ç –≤ v1
   - Migration path
   - –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫—É—é –≤–µ—Ä—Å–∏—é

---

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
/srv/sys/
‚îú‚îÄ‚îÄ ssh/
‚îÇ   ‚îú‚îÄ‚îÄ sshd_config.d/          Per-user SSH config snippets
‚îÇ   ‚îú‚îÄ‚îÄ key-export/             SSH keys (export –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ win_config/             Windows SSH config template
‚îÇ   ‚îî‚îÄ‚îÄ ssh_session/            Session logs —Å SID tracking
‚îú‚îÄ‚îÄ iptables/
‚îÇ   ‚îî‚îÄ‚îÄ v4/, v6/               Firewall rules (deduped)
‚îú‚îÄ‚îÄ audit/
‚îÇ   ‚îî‚îÄ‚îÄ rules.d/               Auditd rules
‚îú‚îÄ‚îÄ systemd/
‚îÇ   ‚îî‚îÄ‚îÄ system/                Systemd unit files
‚îî‚îÄ‚îÄ deploy/
    ‚îî‚îÄ‚îÄ ssh-gate-deploy-*.tar.gz  Ready-to-download archive

/srv/home/
‚îú‚îÄ‚îÄ <user>/
‚îÇ   ‚îú‚îÄ‚îÄ local/rbin/            Role-based restricted commands
‚îÇ   ‚îî‚îÄ‚îÄ .ssh/authorized_keys   SSH public keys
‚îî‚îÄ‚îÄ gate/
    ‚îú‚îÄ‚îÄ local/bin/             Gate helper scripts
    ‚îî‚îÄ‚îÄ local/rbin/2<user>     Switch commands
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –§—É–Ω–∫—Ü–∏—è | –õ–æ–∫–∞—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|-----------|
| Per-user SSH | `/srv/sys/ssh/sshd_config.d/10-user_*.conf` | –û—Ç–¥–µ–ª—å–Ω—ã–π config –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| Role-based access | `/srv/home/<user>/local/rbin/` | Symlinks –Ω–∞ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã |
| Firewall | `/srv/sys/iptables/v4/merged.v4` | Deduped –ø—Ä–∞–≤–∏–ª–∞ IPTables |
| Session logs | `/srv/sys/ssh/ssh_session/<date>/` | SID-based session tracking |
| Keys export | `/srv/sys/ssh/key-export/<user>/` | –î–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è |
| Deploy archive | `/srv/sys/deploy/` | –ì–æ—Ç–æ–≤—ã–π –∞—Ä—Ö–∏–≤ —Å –∫–ª—é—á–∞–º–∏ –∏ –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ |

---

## üéØ –¢–∏–ø–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```bash
sudo bash install_ssh_gate_v2.sh
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π wizard
```
‚Üí See: [QUICK_START_V2.sh](QUICK_START_V2.sh)

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
sudo bash install_ssh_gate_v2.sh
# –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞: Add additional user? [y/N]: y
```
‚Üí See: [ADMIN_GUIDE_V2.md#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](ADMIN_GUIDE_V2.md)

### –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
sudo userdel -r username
sudo rm -rf /srv/home/username
sudo rm /srv/sys/ssh/sshd_config.d/10-user_username.*
sudo rm /srv/home/gate/local/rbin/2username
sudo systemctl reload ssh
```
‚Üí See: [ADMIN_GUIDE_V2.md#—É–¥–∞–ª–µ–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](ADMIN_GUIDE_V2.md)

### –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å
sudo mv /srv/sys/ssh/sshd_config.d/10-user_username.conf \
       /srv/sys/ssh/sshd_config.d/10-user_username.conf.OFF
sudo systemctl reload ssh

# –í–∫–ª—é—á–∏—Ç—å
sudo mv /srv/sys/ssh/sshd_config.d/10-user_username.conf.OFF \
       /srv/sys/ssh/sshd_config.d/10-user_username.conf
sudo systemctl reload ssh
```
‚Üí See: [ADMIN_GUIDE_V2.md#–≤–∫–ª—é—á–µ–Ω–∏–µ–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](ADMIN_GUIDE_V2.md)

### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π
```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
scp -P 22 gate@server:/srv/sys/deploy/ssh-gate-deploy-*.tar.gz ./
tar -xzf ssh-gate-deploy-*.tar.gz
cd ssh-gate-deploy-*/

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª—é—á–µ–π
mkdir -p ~/.ssh && chmod 700 ~/.ssh
cp keys/username@* ~/.ssh/
chmod 600 ~/.ssh/username@*
cat configs/ssh_config >> ~/.ssh/config
```
‚Üí See: [ADMIN_GUIDE_V2.md#—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ-–∫–ª—é—á–µ–π](ADMIN_GUIDE_V2.md)

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ –≤ firewall
```bash
# –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –≤—ã–±—Ä–∞—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª —Å –ø–æ—Ä—Ç–∞–º–∏
sudo bash install_ssh_gate_v2.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
sudo iptables -A INPUT -p tcp --dport 9000 -j ACCEPT
sudo /usr/local/sbin/restore_srv_iptables.sh save
```
‚Üí See: [ADMIN_GUIDE_V2.md#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–Ω–æ–≤–æ–≥–æ-–ø–æ—Ä—Ç–∞](ADMIN_GUIDE_V2.md)

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–µ—Å—Å–∏–π
```bash
tail -f /srv/sys/ssh/ssh_session/$(date +%d-%b\'%y | tr a-z A-Z)/*.log
grep "USER=username" /srv/sys/ssh/ssh_session/*/*.log
grep "192.168.1.50" /srv/sys/ssh/ssh_session/*/*.log
```
‚Üí See: [ADMIN_GUIDE_V2.md#–ø—Ä–æ—Å–º–æ—Ç—Ä-–ª–æ–≥–æ–≤-—Å–µ—Å—Å–∏–π](ADMIN_GUIDE_V2.md)

### –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ IP
```bash
sudo ipset add ssh_ban 192.168.1.50 timeout 3600
sudo ipset list ssh_ban
```
‚Üí See: [ADMIN_GUIDE_V2.md#ip-based-whitelistban](ADMIN_GUIDE_V2.md)

---

## üîß –í—ã–±–æ—Ä –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—é

### –Ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
‚Üí [QUICK_START_V2.sh](QUICK_START_V2.sh) + [ADMIN_GUIDE_V2.md](ADMIN_GUIDE_V2.md)

### –£ –º–µ–Ω—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ —Ä–∞–∑–Ω–æ–≥–æ —Ç–∏–ø–∞
‚Üí [EXAMPLES_V2.md](EXAMPLES_V2.md) (Web, Mail, Database examples)

### –Ø –º–∏–≥—Ä–∏—Ä—É—é —Å v1 –Ω–∞ v2
‚Üí [V1_VS_V2.md](V1_VS_V2.md) (Migration path)

### –Ø —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é/–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é —Å–∫—Ä–∏–ø—Ç
‚Üí [V2_ENHANCEMENTS.md](V2_ENHANCEMENTS.md) + –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –≤ `install_ssh_gate_v2.sh`

### –Ø –∏—â—É troubleshooting –ø–æ–º–æ—â—å
‚Üí [ADMIN_GUIDE_V2.md#troubleshooting](ADMIN_GUIDE_V2.md)

---

## üìÅ –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

| –§–∞–π–ª | –†–∞–∑–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `install_ssh_gate_v2.sh` | ~25 KB | **–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ v2** |
| `install_ssh_env.sh` | ~30 KB | SSH gate v1 (legacy) |
| `install_nginx_certbot.sh` | ~6 KB | Nginx + Certbot SSL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –†–∞–∑–º–µ—Ä | –î–ª—è –∫–æ–≥–æ |
|------|--------|----------|
| `QUICK_START_V2.sh` | ~11 KB | –ù–æ–≤–∏—á–∫–æ–≤ (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥–∞–π–¥) |
| `V2_ENHANCEMENTS.md` | ~20 KB | –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏) |
| `ADMIN_GUIDE_V2.md` | ~30 KB | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ) |
| `EXAMPLES_V2.md` | ~20 KB | –í—Å–µ—Ö (–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã) |
| `V1_VS_V2.md` | ~15 KB | –ú–∏–≥—Ä–∏—Ä—É—é—â–∏—Ö —Å v1 (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ) |
| `README.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª) | ~5 KB | –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ |

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `index.html` | Login page –¥–ª—è nginx |
| `unauthorized.html` | Error page –¥–ª—è nginx |
| `nginx_site.conf.template` | Nginx –∫–æ–Ω—Ñ–∏–≥ —à–∞–±–ª–æ–Ω |

---

## ‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **OS**: Ubuntu 20.04 LTS, 22.04 LTS, –∏–ª–∏ 24.04 LTS (CentOS/AlmaLinux —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç)
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: x86_64 (amd64)
- **–†–∞–∑–º–µ—Ä –¥–∏—Å–∫–∞**: 500MB –º–∏–Ω–∏–º—É–º –¥–ª—è `/srv/sys/`
- **RAM**: 512MB –º–∏–Ω–∏–º—É–º
- **–°–µ—Ç—å**: –ü—É–±–ª–∏—á–Ω—ã–π IP (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø)

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç:
- OpenSSH (sshd)
- IPTables / IP6Tables
- IPSet
- Auditd
- Systemd (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–°–∏—Å—Ç–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- ‚úì **–ö–ª—é—á-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞**: Only SSH keys, no passwords
- ‚úì **Restricted shell**: rbash –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úì **Session tracking**: –í—Å–µ —Å–µ—Å—Å–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å SID
- ‚úì **Role-based**: –†–∞–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úì **Auditd**: All changes logged to auditd
- ‚úì **IPTables**: Stateful firewall —Å whitelisting
- ‚úì **Auto-ban**: IP bans after 3 failed auth attempts

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –≤ 4 —à–∞–≥–∞

### 1. –°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd ~
curl -O https://your-repo/install_ssh_gate_v2.sh
# –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π wizard
```bash
sudo bash install_ssh_gate_v2.sh
```

### 3. –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
- –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (2 —Å–µ–∫ –∞–≤—Ç–æ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ)
- –í–≤–µ–¥–∏—Ç–µ SSH port
- –°–æ–∑–¥–∞–π—Ç–µ gate –∏ main –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

### 4. –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ —Å –∫–ª—é—á–∞–º–∏
```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
scp -P <ssh_port> gate@<server>:/srv/sys/deploy/ssh-gate-deploy-*.tar.gz ./
tar -xzf ssh-gate-deploy-*.tar.gz
```

**–ì–æ—Ç–æ–≤–æ!** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SSHD**:
   ```bash
   sudo sshd -t
   ```

2. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ SSH**:
   ```bash
   sudo journalctl -u ssh -n 50
   tail -50 /var/log/auth.log
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall**:
   ```bash
   sudo iptables -L INPUT -n | head -20
   ```

4. **–ß–∏—Ç–∞–π—Ç–µ [ADMIN_GUIDE_V2.md#troubleshooting](ADMIN_GUIDE_V2.md#troubleshooting)**

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ

- [Linux rbash restricted shell](https://www.gnu.org/software/bash/manual/html_node/The-Restricted-Shell.html)
- [OpenSSH documentation](https://man.openbsd.org/sshd_config)
- [IPTables guide](https://linux.die.net/man/8/iptables)
- [auditd framework](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/chap-system_auditing)

---

## üìù –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

- **v2.0** (Current) - Per-user snippets, auto-cleanup, protocol selection, deduped iptables, deployment archive
- **v1.0** - Basic SSH gate environment

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–°–∫—Ä–∏–ø—Ç—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è AS-IS. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Ä–∏—Å–∫. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ non-production –ø–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º.

---

## üéì –û–±—É—á–∞—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

1. **–î–ª—è –Ω–æ–≤–∏—á–∫–æ–≤ –≤ SSH**:
   - –ß–∏—Ç–∞–π—Ç–µ [QUICK_START_V2.sh](QUICK_START_V2.sh) - –∏–º–µ–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥

2. **–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ Linux**:
   - [ADMIN_GUIDE_V2.md](ADMIN_GUIDE_V2.md) - –ø–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

3. **–î–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è**:
   - [EXAMPLES_V2.md](EXAMPLES_V2.md) - —Å—Ü–µ–Ω–∞—Ä–∏–∏ Web, Mail, Database, Hosting

4. **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ DevOps**:
   - [V2_ENHANCEMENTS.md](V2_ENHANCEMENTS.md) - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

---

## ‚úÖ Checklist –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

- [ ] –°–∫–∞—á–∞–Ω —Å–∫—Ä–∏–ø—Ç `install_ssh_gate_v2.sh`
- [ ] Server –∏–º–µ–µ—Ç –º–∏–Ω–∏–º—É–º 500MB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- [ ] –í—ã–±—Ä–∞–Ω SSH port (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2022 –∏–ª–∏ –≤—ã—à–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∏—Ö —Ä–æ–ª–∏
- [ ] –í—ã–±—Ä–∞–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã/–ø–æ—Ä—Ç—ã
- [ ] –°–∫—Ä–∏–ø—Ç —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω (`Apply SSHD configuration? Y`)
- [ ] –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω –≤ `/srv/sys/deploy/`
- [ ] –ê—Ä—Ö–∏–≤ —Å–∫–∞—á–∞–Ω –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É
- [ ] SSH –∫–ª—é—á–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ `~/.ssh/` —Å –ø—Ä–∞–≤–∞–º–∏ 600
- [ ] SSH –∫–æ–Ω—Ñ–∏–≥ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `~/.ssh/config`
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ SSH –∫–æ–Ω–Ω–µ–∫—Ü–∏—è —á–µ—Ä–µ–∑ gate
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä–µ–Ω—ã `/srv/sys/ssh/ssh_session/` –ª–æ–≥–∏)

---

## üîÑ Continuous Improvement

–î–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ maintenance:

```bash
# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
sudo sshd -t              # Validate configuration
sudo iptables -L INPUT    # Check firewall rules

# –ï–∂–µ–º–µ—Å—è—á–Ω–æ
tar -czf /backup/ssh_gate_$(date +%Y-%m-%d).tar.gz /srv/sys/
find /srv/sys/ssh/ssh_session -mtime +90 -delete   # Old logs cleanup

# –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
sudo bash install_ssh_gate_v2.sh                    # Reinitialize with new settings
```

---

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?** 

```bash
sudo bash install_ssh_gate_v2.sh
```

–∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥–∞–π–¥:

```bash
bash QUICK_START_V2.sh
```
