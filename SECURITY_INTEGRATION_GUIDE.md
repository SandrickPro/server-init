# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ v5.0
# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ security-hardening-advanced.sh —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë       –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ - –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –ò–ù–¢–ï–ì–†–ê–¶–ò–ò         ‚ïë
‚ïë                     server-init v5.0 Enhanced                        ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–æ–±–∑–æ—Ä)
2. [–ü–æ—Ä—è–¥–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
3. [9 —É—Ä–æ–≤–Ω–µ–π –∑–∞—â–∏—Ç—ã](#—É—Ä–æ–≤–Ω–∏)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–ø—Ä–æ–≤–µ—Ä–∫–∞)
6. [Troubleshooting](#troubleshooting)
7. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
8. [Checklist –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#checklist)

---

## üîí –û–ë–ó–û–† –°–ò–°–¢–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò {#–æ–±–∑–æ—Ä}

–°–∏—Å—Ç–µ–º–∞ server-init v5.0 –≤–∫–ª—é—á–∞–µ—Ç **–¥–≤–∞ —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**:

### –ë–ê–ó–û–í–´–ô –£–†–û–í–ï–ù–¨ (setup-ssh-security.sh)
‚úÖ –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π SSH-–±–∞–Ω–Ω–µ—Ä  
‚úÖ –û—á–∏—Å—Ç–∫–∞ MOTD –æ—Ç —Ä–µ–∫–ª–∞–º—ã  
‚úÖ Gate-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è ProxyJump  
‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ root-–¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ SSH  
‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ authorized_keys  

### –ü–†–û–î–í–ò–ù–£–¢–´–ô –£–†–û–í–ï–ù–¨ (security-hardening-advanced.sh)
‚úÖ SSH hardening (–ø–æ—Ä—Ç 2222, —Å–∏–ª—å–Ω–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è)  
‚úÖ fail2ban (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞—Ç–∞–∫—É—é—â–∏—Ö)  
‚úÖ iptables Firewall (DROP-all + whitelist)  
‚úÖ 2FA Google Authenticator (–¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)  
‚úÖ IDS —Å–∏—Å—Ç–µ–º—ã (rkhunter, chkrootkit, AIDE)  
‚úÖ auditd (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π)  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
‚úÖ Kernel hardening (–∑–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞)  
‚úÖ –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤  

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ó–∞—â–∏—Ç–∞ —É—Ä–æ–≤–Ω—è enterprise —Å 9 —Å–ª–æ—è–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Defense in Depth)

---

## üì¶ –ü–û–†–Ø–î–û–ö –£–°–¢–ê–ù–û–í–ö–ò {#—É—Å—Ç–∞–Ω–æ–≤–∫–∞}

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨!

```bash
# –®–ê–ì 1: –ë–∞–∑–æ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ü–ï–†–í–´–ú!)
chmod +x setup-ssh-security.sh
sudo ./setup-ssh-security.sh

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - –°–æ–∑–¥–∞–Ω gate-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
# - Root –æ—Ç–∫–ª—é—á—ë–Ω
# - MOTD –æ—á–∏—â–µ–Ω
# - –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –±–∞–Ω–Ω–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

# –®–ê–ì 2: –î–æ–±–∞–≤—å—Ç–µ SSH-–∫–ª—é—á –¥–ª—è gate-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ö–†–ò–¢–ò–ß–ù–û!)
sudo mkdir -p /home/gate/.ssh
sudo nano /home/gate/.ssh/authorized_keys  # –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
sudo chmod 600 /home/gate/.ssh/authorized_keys
sudo chown -R gate:gate /home/gate/.ssh

# –®–ê–ì 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ gate (–ù–ï –ó–ê–ö–†–´–í–ê–ô–¢–ï –¢–ï–ö–£–©–£–Æ –°–ï–°–°–ò–Æ!)
# –û—Ç–∫—Ä–æ–π—Ç–µ –ù–û–í–´–ô —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
ssh gate@your-server-ip

# –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ
# –ï—Å–ª–∏ –ù–ï–¢ - –∏—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º!

# –®–ê–ì 4: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É
chmod +x server-deploy-v5-enhanced.sh
sudo ./server-deploy-v5-enhanced.sh

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (dialog, tmux, jq, htop)
# - –°–æ–∑–¥–∞–Ω—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ /srv/sys/
# - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
# - –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–µ–Ω—é

# –®–ê–ì 5: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–ü–û–°–õ–ï –ø—Ä–æ–≤–µ—Ä–∫–∏ gate!)
chmod +x security-hardening-advanced.sh
sudo ./security-hardening-advanced.sh

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - SSH –ø–æ—Ä—Ç –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ 2222
# - fail2ban –∞–∫—Ç–∏–≤–µ–Ω
# - UFW –Ω–∞—Å—Ç—Ä–æ–µ–Ω
# - 2FA –≥–æ—Ç–æ–≤ –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
# - IDS —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
# - auditd –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è
# - –Ø–¥—Ä–æ –∑–∞—â–∏—â–µ–Ω–æ
```

### üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø

1. **–ù–ï –ó–ê–ö–†–´–í–ê–ô–¢–ï SSH-—Å–µ—Å—Å–∏—é** –ø–æ–∫–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ gate!
2. **–°–û–•–†–ê–ù–ò–¢–ï backup –∫–æ–Ω—Ñ–∏–≥–æ–≤** –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º security-hardening-advanced.sh
3. **–°–û–û–ë–©–ò–¢–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú** –æ —Å–º–µ–Ω–µ SSH –ø–æ—Ä—Ç–∞ –Ω–∞ 2222
4. **–û–ë–ù–û–í–ò–¢–ï firewall –ø—Ä–∞–≤–∏–ª–∞** –Ω–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö
5. **–ù–ê–°–¢–†–û–ô–¢–ï 2FA** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

---

## üõ°Ô∏è 9 –£–†–û–í–ù–ï–ô –ó–ê–©–ò–¢–´ {#—É—Ä–æ–≤–Ω–∏}

### –£–†–û–í–ï–ù–¨ 1: SSH HARDENING

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ú–µ–Ω—è–µ—Ç SSH –ø–æ—Ä—Ç —Å 22 –Ω–∞ 2222 (—É—Ö–æ–¥–∏—Ç –æ—Ç 99% –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∫–∞–Ω–µ—Ä–æ–≤)
- –û—Ç–∫–ª—é—á–∞–µ—Ç root-–¥–æ—Å—Ç—É–ø –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –¢—Ä–µ–±—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ –∫–ª—é—á–∏ (–ø–∞—Ä–æ–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã)
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ gate —Ä–∞–∑—Ä–µ—à—ë–Ω)
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å–∏–ª—å–Ω—É—é –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—é (curve25519, ChaCha20)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/etc/ssh/sshd_config`

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞
systemctl status sshd
netstat -tlnp | grep 2222

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º –ø–æ—Ä—Ç–æ–º
ssh -p 2222 gate@server-ip
```

**–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∫–∞–Ω–µ—Ä–æ–≤ –ø–æ—Ä—Ç–æ–≤
- –ë—Ä—É—Ç—Ñ–æ—Ä—Å –∞—Ç–∞–∫ –Ω–∞ –ø–∞—Ä–æ–ª–∏
- –£—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –∞—Ç–∞–∫
- –ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ root-–¥–æ—Å—Ç—É–ø–∞

---

### –£–†–û–í–ï–ù–¨ 2: FAIL2BAN

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–∞–Ω–∏—Ç IP –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç SSH DDoS (10 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∑–∞ 60 —Å–µ–∫ = –±–∞–Ω)
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞—Ä—É—à–∏—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –±–∞–Ω –Ω–∞ 7 –¥–Ω–µ–π
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/etc/fail2ban/jail.local`

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
fail2ban-client status
fail2ban-client status sshd

# –°–ø–∏—Å–æ–∫ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö IP
fail2ban-client get sshd banned

# –†–∞–∑–±–∞–Ω IP
fail2ban-client set sshd unbanip 1.2.3.4

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f /var/log/fail2ban.log
```

**–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç:**
- –ë—Ä—É—Ç—Ñ–æ—Ä—Å –∞—Ç–∞–∫
- DDoS –Ω–∞ SSH –ø–æ—Ä—Ç
- –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∞—Ç–∞–∫ (botnet)
- –ü–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤–∑–ª–æ–º–∞

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫:**
```bash
# –¢–æ–ø-10 –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö IP
zgrep 'Ban' /var/log/fail2ban.log* | awk '{print $NF}' | sort | uniq -c | sort -rn | head -10
```

---

### –£–†–û–í–ï–ù–¨ 3: UFW FIREWALL

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç –í–°–ï –≤—Ö–æ–¥—è—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (deny-all –ø–æ–ª–∏—Ç–∏–∫–∞)
- –†–∞–∑—Ä–µ—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ SSH –Ω–∞ –ø–æ—Ä—Ç—É 2222
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (6 –∑–∞ 30 —Å–µ–∫—É–Ω–¥)
- –†–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ –∏—Å—Ö–æ–¥—è—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –õ–æ–≥–∏—Ä—É–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/etc/ufw/ufw.conf`

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
ufw status verbose
ufw status numbered

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª (–ø—Ä–∏–º–µ—Ä—ã)
ufw allow 80/tcp comment 'HTTP'
ufw allow 443/tcp comment 'HTTPS'
ufw allow from 192.168.1.0/24 to any port 3306 comment 'MySQL internal'
ufw limit 2222/tcp comment 'SSH with rate limiting'

# –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ (–ø–æ –Ω–æ–º–µ—Ä—É)
ufw delete 5

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f /var/log/ufw.log

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
grep 'UFW BLOCK' /var/log/ufw.log | wc -l
```

**–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç:**
- –ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å–∞–º
- Port scanning
- DDoS –∞—Ç–∞–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Ç–∏
- –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ—Ä—Ç–∞—Ö

---

### –£–†–û–í–ï–ù–¨ 4: 2FA (–î–í–£–•–§–ê–ö–¢–û–†–ù–ê–Ø –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –¢—Ä–µ–±—É–µ—Ç SSH –∫–ª—é—á + –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–¥ –∏–∑ Google Authenticator
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç QR-–∫–æ–¥ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã –Ω–∞ —Å–ª—É—á–∞–π –ø–æ—Ç–µ—Ä–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º)
# apt-get install libpam-google-authenticator

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
google-authenticator

# –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:
# Do you want authentication tokens to be time-based? Y
# (–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Google Authenticator)
# Do you want me to update your "/home/username/.google_authenticator" file? Y
# Do you want to disallow multiple uses of the same token? Y
# Do you want to increase the original generation time window? N
# Do you want to enable rate-limiting? Y

# 3. –°–û–•–†–ê–ù–ò–¢–ï —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ!

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ (–≤—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ)
# –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è: SSH –∫–ª—é—á + 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü—Ä–∏ –≤—Ö–æ–¥–µ:
ssh -p 2222 gate@server-ip
# –í–≤–æ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Google Authenticator (–º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥)
```

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞** (–µ—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω):
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–¥–æ–≤ (emergency scratch codes)
# –ö–∞–∂–¥—ã–π –∫–æ–¥ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π!
```

**–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç:**
- –ö—Ä–∞–∂–∏ SSH –∫–ª—é—á–∞ (–Ω—É–∂–µ–Ω –µ—â—ë –∏ —Ç–µ–ª–µ—Ñ–æ–Ω)
- Phishing –∞—Ç–∞–∫
- Replay attacks
- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–∫—Ç–æ—Ä–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

### –£–†–û–í–ï–ù–¨ 5: IDS (–°–ò–°–¢–ï–ú–´ –û–ë–ù–ê–†–£–ñ–ï–ù–ò–Ø –í–¢–û–†–ñ–ï–ù–ò–ô)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- **rkhunter**: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ rootkit'—ã
- **chkrootkit**: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫–∞–Ω–µ—Ä rootkit'–æ–≤
- **AIDE**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤ (File Integrity Monitoring)

#### RKHUNTER

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
rkhunter --update

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
rkhunter --check --skip-keypress

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞
cat /var/log/rkhunter.log

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ baseline (–ø–æ—Å–ª–µ –ª–µ–≥–∏—Ç–∏–º–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)
rkhunter --propupd
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°–∫—Ä—ã—Ç—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ /dev
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç–∞—Ö (ls, ps, netstat)
- Backdoor –ø–æ—Ä—Ç—ã
- Suspicious strings –≤ kernel modules

#### AIDE

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
aideinit
mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
aide --check

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –ø–æ—Å–ª–µ –ª–µ–≥–∏—Ç–∏–º–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
aide --update
mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞
cat /var/log/aide/aide.log
```

**–ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç:**
- /bin, /sbin, /usr/bin, /usr/sbin
- /lib, /lib64, /usr/lib
- /etc (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- /root
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã

**–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç:**
- Rootkit –∏–Ω—Ñ–µ–∫—Ü–∏–π
- –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- Backdoor —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- –¢—Ä–æ—è–Ω—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º
- Supply chain attacks

---

### –£–†–û–í–ï–ù–¨ 6: AUDITD (–ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ê–£–î–ò–¢)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –õ–æ–≥–∏—Ä—É–µ—Ç –í–°–ï –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–∞—Ö
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ sudo –∫–æ–º–∞–Ω–¥—ã
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–µ—Ç–µ–≤—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –õ–æ–≥–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö –ø—Ä–∞–≤

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/etc/audit/rules.d/audit.rules`

#### –ü–û–ò–°–ö –í –õ–û–ì–ê–• –ê–£–î–ò–¢–ê

```bash
# –í—Å–µ —Å–æ–±—ã—Ç–∏—è sudo
ausearch -k privileged_commands | less

# –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ /etc/passwd
ausearch -k identity | grep passwd

# –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤ —Ñ–∞–π–ª–æ–≤
ausearch -k perm_mod

# –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞
ausearch -k access_denied

# –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ SSH
ausearch -k sshd_config

# –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ firewall
ausearch -k firewall_changes

# –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
ausearch -ua username

# –°–æ–±—ã—Ç–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
ausearch -ts recent

# –û—Ç—á—ë—Ç –ø–æ –≤—Å–µ–º —Å–æ–±—ã—Ç–∏—è–º
aureport --summary
aureport --auth  # –¢–æ–ª—å–∫–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
aureport --failed  # –¢–æ–ª—å–∫–æ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
```

#### –ê–ù–ê–õ–ò–ó –ò–ù–¶–ò–î–ï–ù–¢–ê

```bash
# –ü—Ä–∏–º–µ—Ä: –ù–∞–π—Ç–∏ –∫—Ç–æ –∏–∑–º–µ–Ω–∏–ª /etc/ssh/sshd_config
ausearch -f /etc/ssh/sshd_config -i

# –ü—Ä–∏–º–µ—Ä: –ö—Ç–æ –∑–∞–ø—É—Å–∫–∞–ª –∫–æ–º–∞–Ω–¥—É rm –≤ /var/www
ausearch -c rm -i | grep /var/www

# –ü—Ä–∏–º–µ—Ä: –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ 2024-12-08
ausearch -ts 12/08/2024 00:00:00 -ua suspicious_user
```

**–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç:**
- –ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —É–≥—Ä–æ–∑ (–∏–Ω—Å–∞–π–¥–µ—Ä—ã)
- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ —É—á—ë—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- Compliance –Ω–∞—Ä—É—à–µ–Ω–∏–π (PCI DSS, HIPAA, GDPR)
- Forensics (—Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤)

---

### –£–†–û–í–ï–ù–¨ 7: –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **—Ç–æ–ª—å–∫–æ** security –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–∞—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/etc/apt/apt.conf.d/50unattended-upgrades`

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
systemctl status unattended-upgrades

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (dry-run)
unattended-upgrades --dry-run --debug

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f /var/log/unattended-upgrades/unattended-upgrades.log

# –°–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
grep "Packages that will be upgraded" /var/log/unattended-upgrades/unattended-upgrades.log

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è!)
systemctl stop unattended-upgrades
systemctl disable unattended-upgrades
```

**–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç:**
- –ò–∑–≤–µ—Å—Ç–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (CVE)
- Zero-day —ç–∫—Å–ø–ª–æ–π—Ç–æ–≤ (–ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –ø–∞—Ç—á–∞)
- –£—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –ü–û
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–∞—Ç—á-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞

---

### –£–†–û–í–ï–ù–¨ 8: KERNEL HARDENING

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ó–∞—â–∏—Ç–∞ –æ—Ç IP spoofing
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ICMP redirects (MITM –∞—Ç–∞–∫–∏)
- SYN flood –∑–∞—â–∏—Ç–∞
- ASLR (—Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ kernel –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç ptrace (debugging –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/etc/sysctl.d/99-security.conf`

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
sysctl -a | grep -E "rp_filter|accept_redirects|tcp_syncookies|randomize_va_space"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
sysctl -p /etc/sysctl.d/99-security.conf

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
sysctl net.ipv4.tcp_syncookies

# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ –ª–µ—Ç—É (–≤—Ä–µ–º–µ–Ω–Ω–æ)
sysctl -w net.ipv4.tcp_syncookies=1
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ó–∞—â–∏—Ç–∞ |
|----------|----------|---------|
| `net.ipv4.conf.all.rp_filter` | 1 | IP spoofing |
| `net.ipv4.conf.all.accept_redirects` | 0 | ICMP redirect attacks |
| `net.ipv4.tcp_syncookies` | 1 | SYN flood |
| `net.ipv4.tcp_max_syn_backlog` | 2048 | SYN flood |
| `kernel.randomize_va_space` | 2 | Buffer overflow exploits |
| `kernel.dmesg_restrict` | 1 | Info leak |
| `kernel.kptr_restrict` | 2 | Kernel pointer leak |
| `kernel.yama.ptrace_scope` | 1 | Debugging exploits |

**–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç:**
- Network-level –∞—Ç–∞–∫
- Buffer overflow exploits
- Information disclosure
- Privilege escalation
- MITM –∞—Ç–∞–∫

---

### –£–†–û–í–ï–ù–¨ 9: –ú–ò–ù–ò–ú–ò–ó–ê–¶–ò–Ø –°–ï–†–í–ò–°–û–í

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û—Ç–∫–ª—é—á–∞–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- –£–º–µ–Ω—å—à–∞–µ—Ç attack surface (–ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –∞—Ç–∞–∫–∏)
- –≠–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã (CPU, RAM)

**–û—Ç–∫–ª—é—á–∞–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
- `avahi-daemon` (Zeroconf/Bonjour - –Ω–µ –Ω—É–∂–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- `cups` (–ø–µ—á–∞—Ç—å - –Ω–µ –Ω—É–∂–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- `bluetooth` (Bluetooth - –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- `iscsid` (iSCSI initiator - –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ SAN)

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
systemctl status avahi-daemon cups bluetooth iscsid

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
systemctl list-units --type=service --state=running

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–µ–Ω—É–∂–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
systemctl disable --now ModemManager  # –ú–æ–¥–µ–º—ã
systemctl disable --now whoopsie  # Ubuntu crash reporter
systemctl disable --now apport  # Crash reporter

# –°–ø–∏—Å–æ–∫ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
systemctl list-unit-files --type=service --state=enabled
```

**–ó–∞—â–∏—â–∞–µ—Ç –æ—Ç:**
- –£—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö
- Lateral movement –∞—Ç–∞–∫
- Resource exhaustion
- Zero-day exploits –≤ –ª–∏—à–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

---

## ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ê –ü–û–°–õ–ï –£–°–¢–ê–ù–û–í–ö–ò {#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞}

### 1. –ù–ê–°–¢–†–û–ô–ö–ê EMAIL –£–í–ï–î–û–ú–õ–ï–ù–ò–ô

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—á—Ç–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
apt-get install mailutils postfix

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Postfix (–≤—ã–±–µ—Ä–∏—Ç–µ "Internet Site")
dpkg-reconfigure postfix

# –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏
echo "Test email" | mail -s "Test" your-email@example.com

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π fail2ban
nano /etc/fail2ban/jail.local
# –ò–∑–º–µ–Ω–∏—Ç–µ:
# destemail = your-email@example.com
# sender = fail2ban@your-server.com
```

### 2. –ù–ê–°–¢–†–û–ô–ö–ê SSH –ö–õ–ò–ï–ù–¢–û–í

**–õ–æ–∫–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ ~/.ssh/config:**

```
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ gate-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –Ω–æ–≤–æ–º –ø–æ—Ä—Ç—É
Host myserver
    HostName your-server-ip
    Port 2222
    User gate
    IdentityFile ~/.ssh/id_ed25519
    ServerAliveInterval 60
    ServerAliveCountMax 3

# ProxyJump —á–µ—Ä–µ–∑ gate –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å–µ—Ä–≤–µ—Ä–∞–º
Host internal-server
    HostName 10.0.0.5
    User admin
    ProxyJump myserver
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh myserver

# –ß–µ—Ä–µ–∑ ProxyJump
ssh internal-server

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
scp -P 2222 file.txt gate@myserver:/tmp/
```

### 3. –ù–ê–°–¢–†–û–ô–ö–ê –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

```bash
# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Netdata (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
# fail2ban –ø–ª–∞–≥–∏–Ω
cd /etc/netdata/python.d/
nano fail2ban.conf
# –í–∫–ª—é—á–∏—Ç–µ: enabled: yes

# –ê–ª–µ—Ä—Ç—ã –¥–ª—è Netdata
nano /etc/netdata/health.d/security.conf
```

–î–æ–±–∞–≤—å—Ç–µ:
```
# –ê–ª–µ—Ä—Ç –Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ IP
alarm: fail2ban_bans
on: fail2ban.banned
lookup: sum -1m unaligned
every: 1m
warn: $this > 5
crit: $this > 20
info: More than 20 IPs banned in last minute

# –ê–ª–µ—Ä—Ç –Ω–∞ –Ω–µ—É–¥–∞—á–Ω—ã–µ SSH –ø–æ–ø—ã—Ç–∫–∏
alarm: ssh_failed_logins
on: sshd.failed_logins
lookup: sum -10m unaligned
every: 1m
warn: $this > 10
crit: $this > 50
info: Multiple failed SSH login attempts
```

### 4. BACKUP –í–ê–ñ–ù–´–• –§–ê–ô–õ–û–í

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–π backup
mkdir -p /root/backups/security

# –°–∫—Ä–∏–ø—Ç backup
cat > /root/backup-security.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/root/backups/security/$DATE"
mkdir -p "$BACKUP_DIR"

# Backup –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
cp /etc/ssh/sshd_config "$BACKUP_DIR/"
cp /etc/fail2ban/jail.local "$BACKUP_DIR/"
cp /etc/ufw/ufw.conf "$BACKUP_DIR/"
cp -r /etc/audit/rules.d/ "$BACKUP_DIR/"
cp /etc/sysctl.d/99-security.conf "$BACKUP_DIR/"

# Backup Google Authenticator
cp -r /home/*/.google_authenticator "$BACKUP_DIR/" 2>/dev/null

# –ê—Ä—Ö–∏–≤
tar czf "/root/backups/security-$DATE.tar.gz" "$BACKUP_DIR"
rm -rf "$BACKUP_DIR"

echo "Backup completed: security-$DATE.tar.gz"
EOF

chmod +x /root/backup-security.sh

# –î–æ–±–∞–≤—å—Ç–µ –≤ cron (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00)
echo "0 3 * * * /root/backup-security.sh" | crontab -
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò {#–ø—Ä–æ–≤–µ—Ä–∫–∞}

### –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê (LYNIS)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Lynis
apt-get install lynis

# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞
lynis audit system

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞
cat /var/log/lynis.log

# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
lynis show suggestions
```

### –†–£–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê

```bash
# 1. SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
sshd -t  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
grep -E "^Port|^PermitRootLogin|^PasswordAuthentication|^PubkeyAuthentication" /etc/ssh/sshd_config

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# Port 2222
# PermitRootLogin no
# PasswordAuthentication no
# PubkeyAuthentication yes

# 2. fail2ban
fail2ban-client status sshd
fail2ban-client get sshd banned  # –°–ø–∏—Å–æ–∫ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö

# 3. UFW
ufw status verbose
# –û–∂–∏–¥–∞–µ—Ç—Å—è: Status: active, Default: deny (incoming)

# 4. –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã
netstat -tulpn | grep LISTEN
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ú–ò–ù–ò–ú–£–ú –ø–æ—Ä—Ç–æ–≤ (SSH, –≤–æ–∑–º–æ–∂–Ω–æ Nginx/Apache)

# 5. –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
systemctl list-units --type=service --state=running | wc -l
# –ß–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –ª—É—á—à–µ (–æ–±—ã—á–Ω–æ 20-30 –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ)

# 6. Auditd
auditctl -l | wc -l
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 20 –ø—Ä–∞–≤–∏–ª

# 7. AIDE
aide --check
# –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å unexpected changes

# 8. Kernel –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
sysctl net.ipv4.tcp_syncookies  # = 1
sysctl kernel.randomize_va_space  # = 2

# 9. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
cat /etc/passwd | grep -E ":/bin/bash$|:/bin/sh$"
# –ú–∏–Ω–∏–º—É–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

# 10. Sudo –ø—Ä–∞–≤–∞
cat /etc/sudoers /etc/sudoers.d/*
# –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

# 11. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—Ö–æ–¥—ã
last -20
lastb  # –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏

# 12. –¢–µ–∫—É—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
w
who
```

### –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–ï –ü–û–†–¢–û–í (–° –î–†–£–ì–û–ô –ú–ê–®–ò–ù–´)

```bash
# –° –≤–Ω–µ—à–Ω–µ–π –º–∞—à–∏–Ω—ã
nmap -sS -sV -p- your-server-ip

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# –¢–æ–ª—å–∫–æ –ø–æ—Ä—Ç 2222 (SSH) –æ—Ç–∫—Ä—ã—Ç
# –í–æ–∑–º–æ–∂–Ω–æ: 80, 443 (–µ—Å–ª–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
# –í–æ–∑–º–æ–∂–Ω–æ: —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–æ—Ä—Ç—ã –≤–∞—à–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

# –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# - 22 (—Å—Ç–∞—Ä—ã–π SSH)
# - 3306 (MySQL —Å–Ω–∞—Ä—É–∂–∏)
# - 5432 (PostgreSQL —Å–Ω–∞—Ä—É–∂–∏)
# - 6379 (Redis —Å–Ω–∞—Ä—É–∂–∏)
# - 27017 (MongoDB —Å–Ω–∞—Ä—É–∂–∏)
```

### –ü–†–û–í–ï–†–ö–ê –£–Ø–ó–í–ò–ú–û–°–¢–ï–ô

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ OpenVAS (Greenbone Vulnerability Manager)
apt-get install openvas
gvm-setup
gvm-start

# Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: https://your-server:9392
# Username: admin, Password: (–∏–∑ –≤—ã–≤–æ–¥–∞ gvm-setup)

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Nessus (–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π, –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–π)
```

---

## üêõ TROUBLESHOOTING {#troubleshooting}

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ security-hardening-advanced.sh

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ó–∞–±—ã–ª–∏ —É–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Ä—Ç `-p 2222`
2. Firewall –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –ø–æ—Ä—Ç 2222
3. SSH –∫–ª—é—á –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è gate-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. 2FA –≤–∫–ª—é—á—ë–Ω, –Ω–æ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –®–ê–ì 1: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å –Ω–æ–≤—ã–º –ø–æ—Ä—Ç–æ–º
ssh -p 2222 gate@your-server-ip

# –®–ê–ì 2: –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å —á–µ—Ä–µ–∑ console (VPS –ø–∞–Ω–µ–ª—å, KVM, IPMI)
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH:
systemctl status sshd
journalctl -u sshd -n 50

# –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall
ufw status
ufw allow 2222/tcp  # –ï—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç

# –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nano /etc/ssh/sshd_config
# –£–±–µ–¥–∏—Ç–µ—Å—å: Port 2222, AllowUsers gate

# –®–ê–ì 5: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ SSH
systemctl restart sshd

# –®–ê–ì 6: –ï—Å–ª–∏ 2FA –ø—Ä–æ–±–ª–µ–º–∞, –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ:
nano /etc/pam.d/sshd
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ: # auth required pam_google_authenticator.so

nano /etc/ssh/sshd_config
# –ò–∑–º–µ–Ω–∏—Ç–µ: ChallengeResponseAuthentication no

systemctl restart sshd
```

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: fail2ban —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π, –∑–∞–±–∞–Ω–∏–ª –ª–µ–≥–∏—Ç–∏–º–Ω—ã–π IP

```bash
# –†–∞–∑–±–∞–Ω IP
fail2ban-client set sshd unbanip 1.2.3.4

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ whitelist (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±–∞–Ω–∏—Ç—å)
nano /etc/fail2ban/jail.local

# –î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥ [DEFAULT]:
ignoreip = 127.0.0.1/8 ::1 192.168.1.0/24 YOUR_TRUSTED_IP

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl restart fail2ban

# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# –ò–∑–º–µ–Ω–∏—Ç–µ –≤ [sshd]:
maxretry = 5  # –í–º–µ—Å—Ç–æ 3
```

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: AIDE —Å–æ–æ–±—â–∞–µ—Ç –æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –ü–æ—Å–ª–µ –ª–µ–≥–∏—Ç–∏–º–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ–±–Ω–æ–≤–∏—Ç–µ baseline:
aide --update
mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db

# –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
nano /etc/aide/aide.conf
# –î–æ–±–∞–≤—å—Ç–µ:
!/var/log
!/tmp
!/var/cache

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã
aideinit
```

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: auditd –∑–∞–ø–æ–ª–Ω—è–µ—Ç –¥–∏—Å–∫ –ª–æ–≥–∞–º–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
du -sh /var/log/audit/

# –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
nano /etc/audit/auditd.conf
# –ò–∑–º–µ–Ω–∏—Ç–µ:
max_log_file = 50  # MB
num_logs = 5  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
max_log_file_action = ROTATE  # –í–º–µ—Å—Ç–æ KEEP

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl restart auditd

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
find /var/log/audit/ -name "audit.log.*" -mtime +30 -delete
```

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –°–µ—Ä–≤–∏—Å –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏–∑-–∑–∞ UFW

```bash
# –ü—Ä–∏–º–µ—Ä: Nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MySQL

# –í–∞—Ä–∏–∞–Ω—Ç 1: –†–∞–∑—Ä–µ—à–∏—Ç—å loopback (—É–∂–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å)
ufw allow in on lo

# –í–∞—Ä–∏–∞–Ω—Ç 2: –†–∞–∑—Ä–µ—à–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
ufw allow from 127.0.0.1 to 127.0.0.1 port 3306

# –í–∞—Ä–∏–∞–Ω—Ç 3: –†–∞–∑—Ä–µ—à–∏—Ç—å –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–æ–¥—Å–µ—Ç–∏
ufw allow from 192.168.1.0/24 to any port 3306

# –ü—Ä–æ–≤–µ—Ä–∫–∞
ufw status numbered
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò {#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥}

### –ï–ñ–ï–î–ù–ï–í–ù–´–ï –ü–†–û–í–ï–†–ö–ò

```bash
# –°–∫—Ä–∏–ø—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞
cat > /root/daily-security-report.sh << 'EOF'
#!/bin/bash
REPORT="/tmp/security-report-$(date +%Y%m%d).txt"

echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" > "$REPORT"
echo "SECURITY REPORT - $(date)" >> "$REPORT"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" >> "$REPORT"

echo -e "\n1. FAIL2BAN STATUS:" >> "$REPORT"
fail2ban-client status | head -5 >> "$REPORT"
fail2ban-client status sshd >> "$REPORT"

echo -e "\n2. SSH FAILED LOGINS (last 24h):" >> "$REPORT"
grep "Failed password" /var/log/auth.log | tail -20 >> "$REPORT"

echo -e "\n3. NEW USERS (last 24h):" >> "$REPORT"
grep "new user" /var/log/auth.log | tail -10 >> "$REPORT"

echo -e "\n4. SUDO COMMANDS (last 24h):" >> "$REPORT"
grep "sudo:" /var/log/auth.log | tail -20 >> "$REPORT"

echo -e "\n5. OPEN PORTS:" >> "$REPORT"
netstat -tulpn | grep LISTEN >> "$REPORT"

echo -e "\n6. TOP 10 PROCESSES BY CPU:" >> "$REPORT"
ps aux --sort=-%cpu | head -11 >> "$REPORT"

echo -e "\n7. DISK USAGE:" >> "$REPORT"
df -h / >> "$REPORT"

echo -e "\n8. LAST 10 LOGINS:" >> "$REPORT"
last -10 >> "$REPORT"

echo -e "\n9. SECURITY UPDATES AVAILABLE:" >> "$REPORT"
apt-get update -qq 2>/dev/null
apt-get upgrade -s | grep -i security >> "$REPORT"

echo -e "\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" >> "$REPORT"

# –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ email
mail -s "Daily Security Report - $(hostname)" your-email@example.com < "$REPORT"

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
cp "$REPORT" /var/log/security-reports/
EOF

chmod +x /root/daily-security-report.sh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 8:00)
echo "0 8 * * * /root/daily-security-report.sh" | crontab -e
```

### –ú–û–ù–ò–¢–û–†–ò–ù–ì –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: SSH –ø–æ–ø—ã—Ç–∫–∏
tail -f /var/log/auth.log | grep sshd

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: fail2ban –¥–µ–π—Å—Ç–≤–∏—è
tail -f /var/log/fail2ban.log

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: UFW –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
tail -f /var/log/ufw.log | grep BLOCK

# –¢–µ—Ä–º–∏–Ω–∞–ª 4: auditd —Å–æ–±—ã—Ç–∏—è
tail -f /var/log/audit/audit.log
```

### GRAFANA DASHBOARD

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Prometheus + Grafana, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π dashboard:

- **Node Exporter Full**: Dashboard ID 1860
- **fail2ban**: Dashboard ID 7711
- **Linux System**: Dashboard ID 11074

---

## ‚úîÔ∏è CHECKLIST –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò {#checklist}

### –°–†–ê–ó–£ –ü–û–°–õ–ï –£–°–¢–ê–ù–û–í–ö–ò

- [ ] –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (setup-ssh-security.sh)
- [ ] Gate-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] SSH –∫–ª—é—á –¥–ª—è gate —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] Root-–¥–æ—Å—Ç—É–ø –æ—Ç–∫–ª—é—á—ë–Ω
- [ ] –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (security-hardening-advanced.sh)
- [ ] SSH —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 2222
- [ ] fail2ban –∞–∫—Ç–∏–≤–µ–Ω –∏ –±–∞–Ω–∏—Ç –∞—Ç–∞–∫—É—é—â–∏—Ö
- [ ] UFW –Ω–∞—Å—Ç—Ä–æ–µ–Ω (deny-all + whitelist)
- [ ] 2FA –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- [ ] IDS —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (rkhunter, AIDE, chkrootkit)
- [ ] auditd –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã
- [ ] Kernel hardening –ø—Ä–∏–º–µ–Ω—ë–Ω
- [ ] –ù–µ–Ω—É–∂–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã

### –ï–ñ–ï–ù–ï–î–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê

- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä fail2ban —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö IP
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä SSH –ª–æ–≥–æ–≤ (–Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ sudo –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä auditd –æ—Ç—á—ë—Ç–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ AIDE (—Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤)
- [ ] –ê–Ω–∞–ª–∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (htop)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

### –ï–ñ–ï–ú–ï–°–Ø–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê

- [ ] –ó–∞–ø—É—Å–∫ Lynis audit
- [ ] –ó–∞–ø—É—Å–∫ rkhunter --check
- [ ] –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ —Å –≤–Ω–µ—à–Ω–µ–π –º–∞—à–∏–Ω—ã (nmap)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ baseline AIDE
- [ ] –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ backup'–æ–≤
- [ ] –û–±–∑–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö)
- [ ] –û–±–∑–æ—Ä SSH –∫–ª—é—á–µ–π
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ backup

### –ï–ñ–ï–ö–í–ê–†–¢–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê

- [ ] –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Lynis + OpenVAS)
- [ ] Penetration testing (–∏–ª–∏ –Ω–∞—ë–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤)
- [ ] –û–±–∑–æ—Ä –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [ ] –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
- [ ] –û–±–∑–æ—Ä compliance —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (PCI DSS, HIPAA, GDPR)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [ ] –û–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –Ω–æ–≤—ã–º —É–≥—Ä–æ–∑–∞–º

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–°–£–†–°–´

### –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

- **SSH Hardening**: https://www.ssh.com/academy/ssh/sshd_config
- **fail2ban**: https://github.com/fail2ban/fail2ban/wiki
- **UFW**: https://help.ubuntu.com/community/UFW
- **Google Authenticator**: https://github.com/google/google-authenticator-libpam
- **AIDE**: https://aide.github.io/
- **auditd**: https://man7.org/linux/man-pages/man8/auditd.8.html

### –°–¢–ê–ù–î–ê–†–¢–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

- **CIS Benchmarks**: https://www.cisecurity.org/cis-benchmarks/
- **NIST Cybersecurity Framework**: https://www.nist.gov/cyberframework
- **OWASP Top 10**: https://owasp.org/www-project-top-ten/

### –ò–ù–°–¢–†–£–ú–ï–ù–¢–´

- **Lynis**: https://cisofy.com/lynis/
- **OpenVAS**: https://www.openvas.org/
- **Nmap**: https://nmap.org/
- **Wireshark**: https://www.wireshark.org/

---

## üÜò –ü–û–õ–£–ß–ï–ù–ò–ï –ü–û–ú–û–©–ò

### –í –°–ö–†–ò–ü–¢–ê–•

```bash
# –í—ã–∑–æ–≤ —Å–ø—Ä–∞–≤–∫–∏ –≤ server-deploy-v5-enhanced.sh
# –ù–∞–∂–º–∏—Ç–µ H –≤ –ª—é–±–æ–º –º–µ–Ω—é
```

### –õ–û–ì–ò

–í—Å–µ –ª–æ–≥–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤:
- `/var/log/security-hardening.log` - –õ–æ–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `/var/log/auth.log` - SSH –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `/var/log/fail2ban.log` - fail2ban –¥–µ–π—Å—Ç–≤–∏—è
- `/var/log/ufw.log` - Firewall —Å–æ–±—ã—Ç–∏—è
- `/var/log/audit/audit.log` - auditd –ª–æ–≥–∏
- `/srv/sys/logs/server-deploy.log` - –õ–æ–≥ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

### –ö–û–ù–¢–ê–ö–¢–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª Troubleshooting –≤—ã—à–µ
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ª–æ–≥–∏
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
4. –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–î–∞—Ç–∞:** 2024-12-08  
**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** server-init v5.0 Enhanced Edition  
**–ê–≤—Ç–æ—Ä:** GitHub Copilot (Claude Sonnet 4.5)  

---

**üéâ –ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –í–∞—à —Å–µ—Ä–≤–µ—Ä –∑–∞—â–∏—â—ë–Ω –Ω–∞ —É—Ä–æ–≤–Ω–µ enterprise!**

**Defense in Depth:** 9 —Å–ª–æ—ë–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞—â–∏—â–∞—é—Ç –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É –æ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —É–≥—Ä–æ–∑.

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Å–ª–µ–∂–µ–Ω–æ.

**–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ IDS –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –∞—Ç–∞–∫–∏ –¥–æ –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

**–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ checklist –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

**Remember:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å, –∞ –Ω–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏!
